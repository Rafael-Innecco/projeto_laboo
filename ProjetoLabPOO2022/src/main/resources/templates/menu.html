<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title> Menu Principal </title>
	
		<style>
		    body{
              background-color:#28272c;	
              color: yellow;
			  font-family: "Courier New";
			  font-size: 14px;		  
			}
			
			.caixaBusca{
			  padding: 20px;
              text-align: center;
              display: inline-block;
			  font-family: "Courier New";	
              font-size: 14px;
			  display: block;
			  margin-top: 180px;
              margin-left: auto;
              margin-right: auto;
			  width: 50%;
              cursor: pointer;
			  border-radius: 26px;
			  background-color: #28272c;
			  border: 1px solid MediumSeaGreen;
			  color: MediumSeaGreen;
			}
			   
			.botao1{
              padding: 18px;
              text-align: center;
              display: inline-block;
			  font-family: "Courier New";	
              font-size: 20px;
              cursor: pointer;
			  border-radius: 8px;
			  transition-duration: 0.4s;
			  display: block;
			  margin-top: 10px;
			  margin-left: auto;
              margin-right: auto;
			  margin-bottom: 30px;
			  
			}
			
			.animated{
			  background-color: #28272c;
              color: MediumSeaGreen;
			  border: 1px solid MediumSeaGreen;
			}
			
			.animated:hover{
			  background-color: MediumSeaGreen;
              color: #28272c;
			}	
			
			.botao2{
              padding: 10px;
              text-align: center;
              display: inline-block;
			  font-family: "Courier New";	
              font-size: 13px;
              margin: 2px 1px;
              cursor: pointer;
			  border-radius: 26px;
			  background-color: Tomato;
			  color: #28272c;			  
			}	
			
		</style>
	</head>
	
	<body onload="busca()">
	    <!-- busca musica -->
		<form>
			<input class="caixaBusca" type="text" th:name="nome-busca" id="nome-busca-input" value="Digite um item para buscar..."> 
			<input class="botao1 animated" type="submit" value="Buscar"/>
		</form>

		<script>
			
		</script>
		
		<!-- cria Playslist -->
		<form th:action="@{/menu/cria-playlist}">
			<input type="text" th:name="nome-da-playlist" value="Nome Playlist..."> 
			<input class="botao2" type="submit" value="criar"/>
		</form>
		
		<!-- remove Playslist -->
		<form th:action="@{/menu/remove-playlist}">
		    <input type="text" th:name="playlist-selecionada" value="Nome Playlist..."> 
            <input class="botao2" type="submit" value="apagar"/>
		</form>

		<!-- insere musica na Playlist -->
		<form th:action="@{/menu/adiciona-itens}">
		    <input type="text" th:name="playlist-selecionada" value="Playlist..."> 
		    <input type="text" th:name="uris" value="Item..."> 
            <input class="botao2" type="submit" value="inserir"/>
		</form>
		
		<!-- Remove musica da Playlist -->
		<form th:action="@{/menu/remove-itens-de-playlist}">
		    <input type="text" th:name="playlist-selecionada" value="Playlist..."> 
			<input type="text" th:name="uris" value="Item..."> 
            <input class="botao2" type="submit" value="remover"/>
		</form>

        <form th:action="@{lista-itens-de-playlist}">
		    <input type="text" th:name="playlist-selecionada" value="Nome Playlist..."> 
            <input class="botao2" type="submit" value="listar Musicas"/>
		</form>
		
		<!-- Lista Playlists -->
		<form>
            <button class="botao2" type="button" onclick="listaPlaylists()">listar Playlists</button>
		</form>

		<div id="resultadosDeBusca">
			<p>---------------------------------</p>
			<h2>Musicas Buscadas:</h2> <br>
		</div>
		
		<div id="itens-de-playlist">
			<p>---------------------------------</p>
			<h2>Musicas da Playlist:</h2><br>
		</div>
		
		<div id="lista-de-playlists">
			<p>---------------------------------</p>
			<h2>Playlists:</h2> <br>
		</div>
		
		<script>
			function getQueryVariable(variable)
			{
			       var query = window.location.search.substring(1);
			       var vars = query.split("&");
			       for (var i=0;i<vars.length;i++) {
			               var pair = vars[i].split("=");
			               if(pair[0] == variable){return pair[1];}
			       }
			       return(false);
			}
			
			function busca(){
				var queyParam = getQueryVariable("nome-busca");
				if (queyParam == false)
					return;
				console.log("buscando...");
				fetch('/menu/busca-musica?nome-busca=' + getQueryVariable("nome-busca"))
					.then(function (response) {
						console.log('Primeiro then');
						return response.json();
					})
					.then(function (data) {
						console.log('Segundo then');
						appendData_busca(data, "resultadosDeBusca");
					})
					.catch(function (err) {
						console.log('Terceiro then');
						console.log('error: ' + err);
					});
			}
			
			function appendData_busca(data, elementId) {
				var mainContainer = document.getElementById(elementId);
				for (var i = 0; i < data.length; i++) {
					var h4 = document.createElement("h4");
					h4.innerHTML = 'Name: ' + data[i].name + ' ;';
					console.log('Name: ' + data[i].name + ' ;');
					mainContainer.appendChild(h4);
				}
			}
			
			function listaPlaylists(){
				console.log("buscando...");
				fetch('/menu/lista-playlists?')
					.then(function (response) {
						return response.json();
					})
					.then(function (data) {
						appendData_playlist(data);
					})
					.catch(function (err) {
						console.log('error: ' + err);
					});
				
			}
			
			function appendData_playlist(data) {
				var mainContainer = document.getElementById("lista-de-playlists");
				for (var i = 0; i < data.length; i++) {
					var div = document.createElement('div');
					var h4 = document.createElement('h4');
					var button_remover = document.createElement('button');
					var button_listar = document.createElement('button');

					h4.innerHTML = 'Name: ' + data[i].name + ' ;';
					
					button_remover.setAttribute('class', 'botao2');
					button_remover.type = 'button';
					button_remover.setAttribute('onclick', 'deletaPlaylist("' + data[i].id + '")');
					button_remover.innerHTML = 'Remover';
					
					button_listar.setAttribute('class', 'botao2');
					button_listar.type = 'button';
					button_listar.setAttribute('onclick', 'listaItens("' + data[i].id + '")');
					button_listar.innerHTML = 'Listar mÃºsicas';
					
					div.appendChild(h4);
					div.appendChild(button_remover);
					div.appendChild(button_listar);

					console.log('Name: ' + data[i].name + ' ;');
					console.log('Id: ' + data[i].id + ' ;');
					mainContainer.appendChild(div);
				}
			}

			function deletaPlaylist(idDaPlaylist) {
				console.log(idDaPlaylist);
				fetch('/menu/remove-playlist?playlist-selecionada=' + idDaPlaylist)
					.then(function (response) {
						console.log("Playlist removida?");
						console.log(response);
						return response.json();
					})
					.then(function (data) {
						console.log(">:(");
					})
					.catch(function (err) {
						console.log('erro ao remover playlist: ' + err);
					});
			}
			
			function listaItens(idDaPlaylist) {
				console.log("Playlist listada: " + idDaPlaylist);
				fetch('/menu/lista-itens-de-playlist?playlist-selecionada=' + idDaPlaylist)
					.then(function (response) {
						return response.json();
					})
					.then(function (data) {
						appendData_itens(data, "itens-de-playlist");
					})
					.catch(function (err) {
						console.log("Erro ao listar playlist: " + err);
					}); 
			}
			
			function appendData_itens(data, elementId) {
				var mainContainer = document.getElementById(elementId);
				for (var i = 0; i < data.length; i++) {
					var h4 = document.createElement("h4");
					h4.innerHTML = 'Name: ' + data[i].track.name + ' ;';
					console.log('Name: ' + data[i].track.name + ' ;');
					mainContainer.appendChild(h4);
				}
			}
		</script>
	</body>
</html>
